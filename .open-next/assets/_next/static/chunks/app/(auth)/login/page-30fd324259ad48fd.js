(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},854:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(2115),n=r(8489),s=r(2378),o=r(5950);n.F.defaults.withCredentials=!0;let l=()=>{let[e,t]=(0,a.useState)(null),[r,l]=(0,a.useState)(!0),i=(0,a.useCallback)(e=>{if(!e)return;let t={expires:7,path:"/",domain:window.location.hostname,sameSite:"None",secure:!0};try{s.A.remove("token",{path:"/"}),s.A.set("token",e,t),s.A.get("token")||(console.warn("Le cookie n'a pas \xe9t\xe9 correctement d\xe9fini"),document.cookie="token=".concat(e,"; path=/; secure=true; samesite=None; max-age=").concat(604800)),localStorage.setItem("token",e),n.F.defaults.headers.common.Authorization="Bearer ".concat(e)}catch(e){console.error("Erreur lors de la configuration du cookie:",e)}},[]),c=(0,a.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s.A.remove("token",{path:"/"}),delete n.F.defaults.headers.common.Authorization,t(null)},[]),u=(0,a.useCallback)(async e=>{try{let t=await n.F.get("".concat(o.H,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(e)},withCredentials:!0});return 200===t.status}catch(e){return!1}},[]),d=async(e,r)=>{try{let{data:a}=await n.F.post("/auth/login",{email:e,password:r});if(!a.token)throw Error("Token manquant dans la r\xe9ponse");let s={email:e,username:a.username||e.split("@")[0],role:a.roles||[],token:a.token};return i(a.token),localStorage.setItem("user",JSON.stringify(s)),t(s),s}catch(e){throw c(),e}},p=(0,a.useCallback)(async()=>{try{await n.F.post("".concat(o.H,"/auth/logout"),{},{withCredentials:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})}catch(e){console.error("Erreur lors de la d\xe9connexion:",e)}finally{c()}},[c]),m=(0,a.useCallback)(async()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(!e||!r)return void c();try{if(!await u(e)){console.warn("Session expir\xe9e ou invalide"),c();return}let a=JSON.parse(r);if(a.token!==e){console.warn("Incoh\xe9rence entre les tokens stock\xe9s"),c();return}t(a),i(e)}catch(e){console.error("Erreur lors de la v\xe9rification de session:",e),c()}},[c,i,u]);return(0,a.useEffect)(()=>{m().finally(()=>l(!1))},[m]),(0,a.useEffect)(()=>{let e=setInterval(m,3e5);return()=>clearInterval(e)},[m]),{userData:e,isLoading:r,login:d,logout:p,isAuthenticated:!!e}}},919:(e,t,r)=>{"use strict";r.d(t,{pe:()=>n});let{Axios:a,AxiosError:n,CanceledError:s,isCancel:o,CancelToken:l,VERSION:i,all:c,Cancel:u,isAxiosError:d,spread:p,toFormData:m,AxiosHeaders:h,HttpStatusCode:f,formToJSON:v,getAdapter:x,mergeConfig:g}=r(5125).A},2378:(e,t,r)=>{"use strict";function a(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)e[a]=r[a]}return e}r.d(t,{A:()=>n});var n=function e(t,r){function n(e,n,s){if("undefined"!=typeof document){"number"==typeof(s=a({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var l in s)s[l]&&(o+="; "+l,!0!==s[l]&&(o+="="+s[l].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+o}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],a={},n=0;n<r.length;n++){var s=r[n].split("="),o=s.slice(1).join("=");try{var l=decodeURIComponent(s[0]);if(a[l]=t.read(o,l),e===l)break}catch(e){}}return e?a[e]:a}},remove:function(e,t){n(e,"",a({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,a({},this.attributes,t))},withConverter:function(t){return e(a({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},2573:(e,t,r)=>{Promise.resolve().then(r.bind(r,8614))},3863:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var a=r(5155),n=r(5239),s=r(2115);let o=e=>{let{images:t}=e,r=(e=>{let[t,r]=(0,s.useState)(0),a=(0,s.useCallback)(()=>{let r=Math.floor(Math.random()*e.length);return r===t?(r+1)%e.length:r},[e.length,t]);return(0,s.useEffect)(()=>{0===t&&r(a())},[a,t]),t})(t);return(0,a.jsx)("div",{className:"relative inset-0 w-full h-full",children:(0,a.jsx)("div",{className:"absolute inset-0 w-full h-full",children:(0,a.jsx)(n.default,{src:t[r],alt:"Background",fill:!0,sizes:"(max-width: 414px) 414px, (max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw",className:"object-cover opacity-50 transition-opacity duration-500",priority:!0,quality:75})})})}},5950:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});let a="http://localhost:4000"},8489:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var a=r(5125),n=r(2378);a.A.defaults.withCredentials=!0;let s=a.A.create({baseURL:"http://localhost:4000"});s.interceptors.request.use(e=>{let t=n.A.get("token")||localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>{var t;return["/api/synthetisers"].includes(e.config.url)||null==(t=e.response)||t.status,Promise.reject(e)}),s.interceptors.response.use(e=>e,e=>(e.response?(console.error("Erreur de r\xe9ponse:",{status:e.response.status,data:e.response.data}),401===e.response.status&&localStorage.removeItem("token")):e.request?console.error("Erreur de requ\xeate:",e.request):console.error("Erreur:",e.message),Promise.reject(e)))},8614:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),n=r(2115),s=r(63),o=r(919),l=r(854);function i(){let[e,t]=(0,n.useState)(""),[r,i]=(0,n.useState)(""),[c,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(!1),{login:m}=(0,l.A)(),h=(0,s.useRouter)(),f=(0,s.useSearchParams)(),v=async t=>{t.preventDefault(),p(!0),u(null);try{await m(e,r);let t=f.get("callbackUrl");h.push(t||"/synthetisers")}catch(e){var a,n;u(e instanceof o.pe?(null==(n=e.response)||null==(a=n.data)?void 0:a.message)||"Erreur de connexion":"Erreur inattendue")}finally{p(!1)}};return(0,a.jsxs)("form",{onSubmit:v,className:"mt-8 space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),placeholder:"Email",required:!0,className:"appearance-none rounded-t-md relative block w-full px-3 py-2 border text-black",disabled:d})}),(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"password",value:r,onChange:e=>i(e.target.value),placeholder:"Mot de passe",required:!0,className:"appearance-none rounded-b-md relative block w-full px-3 py-2 border text-black",disabled:d})})]}),c&&(0,a.jsx)("div",{className:"text-red-600 text-center",children:c}),(0,a.jsx)("button",{type:"submit",className:"w-full py-2 px-4 border border-transparent rounded-md text-white bg-blue-900/50 hover:bg-blue-800 disabled:opacity-50",disabled:d,children:d?"Connexion...":"Se connecter"})]})}var c=r(3863);function u(){let e=["/images/login.webp","/images/login2.webp"];return(0,a.jsxs)("div",{className:"relative min-h-screen flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 z-0",children:(0,a.jsx)(c.default,{images:e})}),(0,a.jsx)("div",{className:"relative z-10 min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,a.jsx)("h2",{className:"z+10 mt-6 text-center text-3xl font-extrabold text-white bg-black/50 p-4 rounded-lg backdrop-blur-sm",children:"Connexion"}),(0,a.jsxs)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:[(0,a.jsx)(c.default,{images:e}),(0,a.jsx)(i,{})]})]})})]})}}},e=>{e.O(0,[239,125,441,255,358],()=>e(e.s=2573)),_N_E=e.O()}]);