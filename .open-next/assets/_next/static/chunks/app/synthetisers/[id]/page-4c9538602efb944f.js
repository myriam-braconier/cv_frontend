(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[912],{199:(e,t,s)=>{Promise.resolve().then(s.bind(s,7365))},5654:(e,t,s)=>{"use strict";s.d(t,{w:()=>o});var r=s(5155),a=s(2115),n=s(8489),i=s(5950),l=s(2663),c=s(63);function o(e){let{synthetiserId:t,onPostAdded:s}=e,[o,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(""),[h,x]=(0,a.useState)(!1),[p,j]=(0,a.useState)(null),f=(0,c.useRouter)(),g=async e=>{if(e.preventDefault(),!o.trim()||!u.trim())return void j("Le titre et le commentaire sont requis");x(!0),j(null);try{let e=localStorage.getItem("token");if(!e){j("Vous devez \xeatre connect\xe9 pour ajouter un commentaire"),l.oR.error("Veuillez vous connecter");return}n.F.defaults.headers.common.Authorization="Bearer ".concat(e);let r=JSON.parse(atob(e.split(".")[1])).id,a=await n.F.post("".concat(i.H,"/api/posts"),{titre:o.trim(),commentaire:u.trim(),synthetiserId:t,userId:r,type_contenu:"texte",statut:"publi\xe9"});if(201===a.status){l.oR.success("Commentaire ajout\xe9 avec succ\xe8s"),d(""),m("");let e=await n.F.get("".concat(i.H,"/api/posts/").concat(a.data.id),{params:{include:["author"]}});200===e.status&&(s(),f.refresh())}}catch(t){var r,a;let e=(null==(a=t.response)||null==(r=a.data)?void 0:r.message)||"Erreur lors de l'ajout du commentaire";j(e),l.oR.error(e)}finally{x(!1)}};return(0,r.jsxs)("form",{onSubmit:g,className:"mt-4 space-y-4",children:[p&&(0,r.jsx)("div",{className:"text-red-500 text-sm",children:p}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),placeholder:"Titre du commentaire",className:"w-full p-2 border rounded",required:!0,minLength:3})}),(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),placeholder:"Votre commentaire",className:"w-full p-2 border rounded",rows:3,required:!0,minLength:10})}),(0,r.jsx)("button",{type:"submit",disabled:h||!o.trim()||!u.trim(),className:"w-full py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:h?"Envoi en cours...":"Ajouter un commentaire"})]})}},5950:(e,t,s)=>{"use strict";s.d(t,{H:()=>r});let r="http://localhost:4000"},7365:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(5155),a=s(5950),n=s(63),i=s(2115),l=s(8489),c=s(919),o=s(5239),d=s(5654);function u(){let e=(0,n.useParams)(),[t,s]=(0,i.useState)(null),[u,m]=(0,i.useState)(!0),[h,x]=(0,i.useState)(null),p=(0,i.useCallback)(async()=>{var t,r,n;if(null==e?void 0:e.id)try{let r=localStorage.getItem("token"),n=await l.F.get("".concat(a.H,"/api/synthetisers/").concat(e.id),{headers:{Authorization:"Bearer ".concat(r)},params:{include:["posts","auctionPrices"]}});(null==(t=n.data)?void 0:t.data)&&s(n.data.data)}catch(e){if(e instanceof c.pe&&((null==(r=e.response)?void 0:r.status)===401||(null==(n=e.response)?void 0:n.status)===403)){localStorage.removeItem("token"),window.location.href="/login";return}x("Une erreur est survenue lors du chargement du synth\xe9tiseur")}finally{m(!1)}},[null==e?void 0:e.id]);return((0,i.useEffect)(()=>{p()},[p]),u)?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("p",{className:"text-lg",children:"Chargement..."})}):h?(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("p",{className:"text-red-500",children:h})}):t?(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold mb-6",children:[t.marque," ",t.modele]}),(0,r.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[t.image_url&&(0,r.jsx)("div",{className:"relative h-64 mb-6",children:(0,r.jsx)(o.default,{src:t.image_url,alt:"".concat(t.marque," ").concat(t.modele),fill:!0,className:"object-contain rounded-lg",priority:!0})}),(0,r.jsxs)("div",{className:"space-y-8",children:[t.specifications&&(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Sp\xe9cifications"}),(0,r.jsx)("p",{className:"text-gray-600 leading-relaxed",children:t.specifications})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.note&&(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"\xc9valuation"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("span",{className:"text-lg font-medium",children:[t.note,"/5"]}),t.nb_avis&&(0,r.jsxs)("span",{className:"text-gray-500",children:["(",t.nb_avis," avis)"]})]})]}),t.price&&(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Prix"}),(0,r.jsx)("p",{className:"text-blue-600 font-bold text-2xl",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format("object"==typeof t.price?t.price.value:t.price)})]})]}),Array.isArray(t.auctionPrices)&&t.auctionPrices.length>0&&(0,r.jsxs)("section",{className:"border-t pt-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Derni\xe8re ench\xe8re"}),(0,r.jsx)("p",{className:"text-green-600 font-bold text-2xl",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0}).format(t.auctionPrices[0].proposal_price)})]}),(0,r.jsxs)("section",{className:"border-t pt-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Ajouter un post"}),(0,r.jsx)(d.w,{synthetiserId:t.id,onPostAdded:p})]}),t.posts&&t.posts.length>0&&(0,r.jsxs)("section",{className:"border-t pt-6",children:[(0,r.jsxs)("h2",{className:"text-2xl font-semibold mb-4",children:["Posts (",t.posts.length,")"]}),(0,r.jsx)("div",{className:"space-y-4",children:t.posts.map(e=>(0,r.jsxs)("article",{className:"bg-gray-50 p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[e.titre&&(0,r.jsx)("h3",{className:"font-semibold text-lg",children:e.titre}),e.commentaire&&(0,r.jsx)("p",{className:"mt-2 text-gray-700",children:e.commentaire}),e.createdAt&&(0,r.jsxs)("time",{className:"text-sm text-gray-500 mt-2 block",children:["Post\xe9 le"," ",new Date(e.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})]})]},e.id))})]})]})]})]}):(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("p",{children:"Synth\xe9tiseur non trouv\xe9"})})}},8489:(e,t,s)=>{"use strict";s.d(t,{F:()=>n});var r=s(5125),a=s(2378);r.A.defaults.withCredentials=!0;let n=r.A.create({baseURL:"http://localhost:4000"});n.interceptors.request.use(e=>{let t=a.A.get("token")||localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>{var t;return["/api/synthetisers"].includes(e.config.url)||null==(t=e.response)||t.status,Promise.reject(e)}),n.interceptors.response.use(e=>e,e=>(e.response?(console.error("Erreur de r\xe9ponse:",{status:e.response.status,data:e.response.data}),401===e.response.status&&localStorage.removeItem("token")):e.request?console.error("Erreur de requ\xeate:",e.request):console.error("Erreur:",e.message),Promise.reject(e)))}},e=>{e.O(0,[239,125,771,441,255,358],()=>e(e.s=199)),_N_E=e.O()}]);