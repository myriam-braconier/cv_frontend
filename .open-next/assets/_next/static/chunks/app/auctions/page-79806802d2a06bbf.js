(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17],{854:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(2115),a=r(8489),o=r(2378),l=r(5950);a.F.defaults.withCredentials=!0;let n=()=>{let[e,t]=(0,s.useState)(null),[r,n]=(0,s.useState)(!0),i=(0,s.useCallback)(e=>{if(!e)return;let t={expires:7,path:"/",domain:window.location.hostname,sameSite:"None",secure:!0};try{o.A.remove("token",{path:"/"}),o.A.set("token",e,t),o.A.get("token")||(console.warn("Le cookie n'a pas \xe9t\xe9 correctement d\xe9fini"),document.cookie="token=".concat(e,"; path=/; secure=true; samesite=None; max-age=").concat(604800)),localStorage.setItem("token",e),a.F.defaults.headers.common.Authorization="Bearer ".concat(e)}catch(e){console.error("Erreur lors de la configuration du cookie:",e)}},[]),c=(0,s.useCallback)(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),o.A.remove("token",{path:"/"}),delete a.F.defaults.headers.common.Authorization,t(null)},[]),u=(0,s.useCallback)(async e=>{try{let t=await a.F.get("".concat(l.H,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(e)},withCredentials:!0});return 200===t.status}catch(e){return!1}},[]),d=async(e,r)=>{try{let{data:s}=await a.F.post("/auth/login",{email:e,password:r});if(!s.token)throw Error("Token manquant dans la r\xe9ponse");let o={email:e,username:s.username||e.split("@")[0],role:s.roles||[],token:s.token};return i(s.token),localStorage.setItem("user",JSON.stringify(o)),t(o),o}catch(e){throw c(),e}},h=(0,s.useCallback)(async()=>{try{await a.F.post("".concat(l.H,"/auth/logout"),{},{withCredentials:!0,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})}catch(e){console.error("Erreur lors de la d\xe9connexion:",e)}finally{c()}},[c]),p=(0,s.useCallback)(async()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("user");if(!e||!r)return void c();try{if(!await u(e)){console.warn("Session expir\xe9e ou invalide"),c();return}let s=JSON.parse(r);if(s.token!==e){console.warn("Incoh\xe9rence entre les tokens stock\xe9s"),c();return}t(s),i(e)}catch(e){console.error("Erreur lors de la v\xe9rification de session:",e),c()}},[c,i,u]);return(0,s.useEffect)(()=>{p().finally(()=>n(!1))},[p]),(0,s.useEffect)(()=>{let e=setInterval(p,3e5);return()=>clearInterval(e)},[p]),{userData:e,isLoading:r,login:d,logout:h,isAuthenticated:!!e}}},2110:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(5950),o=r(2115),l=r(7088),n=r(5239),i=r(5125);let c=e=>{let{auctions:t,onUpdateSuccess:r,isAdmin:c=!1}=e;(0,o.useEffect)(()=>{console.log("Is Admin:",c)},[c]);let[u,d]=(0,o.useState)(t),[h,p]=(0,o.useState)(!1),[m,x]=(0,o.useState)(null),[f,v]=(0,o.useState)(null),[g,y]=(0,o.useState)("all"),[b,j]=(0,o.useState)("desc"),[w,k]=(0,o.useState)(0),[N,S]=(0,o.useState)("all"),A=async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette ench\xe8re ?"))try{x(e),v(null),await i.A.delete("".concat(a.H,"/api/auctions/").concat(e),{validateStatus:e=>204===e||e>=200&&e<300}),d(t=>t.filter(t=>t.id!==e)),r&&await r()}catch(a){console.error("Erreur lors de la suppression:",a);let r="Une erreur est survenue lors de la suppression de l'ench\xe8re";if(i.A.isAxiosError(a)){var t,s,o;switch(null==(t=a.response)?void 0:t.status){case 404:r="Cette ench\xe8re n'existe pas ou a d\xe9j\xe0 \xe9t\xe9 supprim\xe9e",d(t=>t.filter(t=>t.id!==e));break;case 403:r="Vous n'avez pas les droits n\xe9cessaires pour supprimer cette ench\xe8re";break;case 401:r="Veuillez vous reconnecter pour effectuer cette action";break;default:(null==(o=a.response)||null==(s=o.data)?void 0:s.message)?r=a.response.data.message:a.response||(r="Impossible de contacter le serveur. Veuillez v\xe9rifier votre connexion.")}}v(r)}finally{x(null)}},C=async()=>{try{p(!0);let e=await i.A.get("".concat(a.H,"/api/auctions")),t=Array.isArray(e.data)?e.data:e.data.data;d(t),r&&await r()}catch(e){console.error("Erreur d\xe9taill\xe9e lors du rafra\xeechissement:",e)}finally{p(!1)}};(0,o.useEffect)(()=>{d(t)},[t]);let E=Array.from(new Set(u.map(e=>e.synthetiserId))),I=u.filter(e=>{let t=0===w||e.synthetiser.id===w,r="all"===N||e.synthetiser.modele===N,s="all"===g||"under1000"===g&&e.proposal_price<1e3||"1000to5000"===g&&e.proposal_price>=1e3&&e.proposal_price<=5e3||"over5000"===g&&e.proposal_price>5e3;return t&&r&&s}).sort((e,t)=>"asc"===b?e.proposal_price-t.proposal_price:t.proposal_price-e.proposal_price);return(0,s.jsx)(l.A,{children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsx)("button",{onClick:C,disabled:h,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50",children:h?"Rafra\xeechissement...":"Rafra\xeechir les ench\xe8res"})}),(0,s.jsxs)("div",{className:"mb-6 space-y-4 md:space-y-0 md:flex md:space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2 text-white",children:"Filtrer par prix"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded",value:g,onChange:e=>y(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Tous les prix"}),(0,s.jsx)("option",{value:"under1000",children:"Moins de 1000€"}),(0,s.jsx)("option",{value:"1000to5000",children:"Entre 1000€ et 5000€"}),(0,s.jsx)("option",{value:"over5000",children:"Plus de 5000€"})]})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2 text-white",children:"Filtrer par mod\xe8le"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded",value:N,onChange:e=>S(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Tous les mod\xe8les"}),Array.from(new Set(u.filter(e=>e.synthetiser&&e.synthetiser.modele).map(e=>e.synthetiser.modele))).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2 text-white",children:"Filtrer par synth\xe9tiseur"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded",value:w,onChange:e=>k(Number(e.target.value)),children:[(0,s.jsx)("option",{value:0,children:"Tous les synth\xe9tiseurs"}),E.map(e=>{var t;let r=null==(t=u.find(t=>t.synthetiserId===e))?void 0:t.synthetiser;return(0,s.jsx)("option",{value:e,children:r?"".concat(r.marque," ").concat(r.modele):"Synth\xe9tiseur ".concat(e)},e)})]})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-2 text-white",children:"Trier par prix"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded",value:b,onChange:e=>j(e.target.value),children:[(0,s.jsx)("option",{value:"desc",children:"Prix d\xe9croissant"}),(0,s.jsx)("option",{value:"asc",children:"Prix croissant"})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:I.map(e=>{var t;return(0,s.jsx)("div",{className:"bg-white bg-opacity/50 rounded-full shadow p-6 hover:shadow-2xl transition-shadow border-2 border-gray-200 w-64 h-64 flex flex-col items-center justify-center mx-auto",children:(0,s.jsxs)("div",{className:"text-center space-y-2 text-orange-600",children:[(0,s.jsx)("div",{className:"relative h-20 w-20 mb-2 mx-auto",children:(null==(t=e.synthetiser)?void 0:t.image_url)?(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-blue-500 opacity-0 group-hover:opacity-20 transition-all duration-300 blur-xl rounded-full"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-all duration-300 blur-lg rounded-full"}),(0,s.jsx)(n.default,{src:e.synthetiser.image_url,alt:"".concat(e.synthetiser.marque," ").concat(e.synthetiser.modele),width:80,height:80,className:"relative z-10 object-cover rounded-full drop-shadow-xl transition-transform duration-300 group-hover:scale-105"})]}):(0,s.jsx)("div",{className:"w-full h-full bg-gray-200 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-gray-500 text-xs",children:"Pas d'image"})})}),(0,s.jsxs)("h3",{className:"font-semibold text-sm",children:["Ench\xe8re #",e.id]}),(0,s.jsx)("p",{className:"text-gray-800 text-xs truncate max-w-[150px]",children:e.synthetiser?"".concat(e.synthetiser.marque," ").concat(e.synthetiser.modele):"Synth\xe9tiseur #".concat(e.synthetiserId)}),(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status}),(0,s.jsxs)("p",{className:"text-lg font-bold",children:[e.proposal_price,"€"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-800",children:["Mis \xe0 jour le :"," ",new Date(e.updatedAt||"").toLocaleDateString()]}),c&&(0,s.jsxs)(s.Fragment,{children:[f&&m===e.id&&(0,s.jsx)("p",{className:"text-xs text-red-500",children:f}),(0,s.jsx)("button",{onClick:()=>A(e.id),disabled:m===e.id,className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs hover:bg-red-600 disabled:opacity-50 transition-colors",children:m===e.id?"...":"Supprimer"})]})]})},e.id)})}),0===I.length&&(0,s.jsx)("p",{className:"text-center text-gray-500 mt-8",children:"Aucune ench\xe8re ne correspond aux crit\xe8res s\xe9lectionn\xe9s"})]})})};function u(){return(0,s.jsx)("div",{className:"col-span-full text-center p-4",role:"status",children:(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)(n.default,{src:"/images/sound.gif",alt:"Chargement",width:128,height:128}),(0,s.jsx)("span",{className:"ml-3",children:"Chargement..."})]})})}var d=r(2141),h=r(854),p=r(3863);function m(){let{userData:e}=(0,h.A)();console.log("userData:",e);let t=(()=>{try{let t=null==e?void 0:e.token.split(".");if(console.log("Token parts:",t),t&&3===t.length){let e=JSON.parse(atob(t[1]));return console.log("Token Payload:",e),console.log("RoleId from payload:",e.roleId),console.log("isAdmin value:",2===e.roleId),2===e.roleId}}catch(e){console.error("Erreur d\xe9taill\xe9e de d\xe9codage du token:",e)}return!1})();console.log("Valeur finale de isAdmin:",t);let[r,l]=(0,o.useState)([]),[n,i]=(0,o.useState)(!0),[m,x]=(0,o.useState)(null),f=(0,o.useCallback)(async()=>{try{i(!0),x(null);let e=await d.A.get("".concat(a.H,"/api/auctions"));if(console.log("Response:",e),!e.data.data)throw Error("Format de donn\xe9es invalide");l(e.data.data)}catch(e){console.error(e),x("Une erreur est survenue lors du chargement des donn\xe9es")}finally{i(!1)}},[]),v=(0,o.useCallback)(()=>{f()},[f]);return((0,o.useEffect)(()=>{f()},[f]),n)?(0,s.jsx)(u,{}):m?(0,s.jsx)("div",{className:"text-red-500 text-center",children:m}):(0,s.jsxs)("main",{className:"min-h-screen",children:[(0,s.jsx)("div",{className:"fixed inset-0 -z-10",children:(0,s.jsx)(p.default,{images:["/images/iStock-1477817772.webp","/images/login2.webp"]})}),(0,s.jsxs)("div",{className:"w-full px-4 py-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center  text-white ",children:"Liste des Ench\xe8res"}),(0,s.jsx)(c,{auctions:r,onUpdateSuccess:v,isAdmin:t})]})]})}},2141:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let s=r(5125).A.create({baseURL:"http://localhost:4000",headers:{"Content-Type":"application/json"},withCredentials:!0}),a=["/api/auctions","/api/synthetisers","/api/users"];s.interceptors.request.use(e=>{if(!a.some(t=>{var r;return null==(r=e.url)?void 0:r.includes(t)})){let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),s.interceptors.response.use(e=>e,async e=>{var t;return(null==(t=e.response)?void 0:t.status)===401&&(localStorage.removeItem("token"),window.location.href="/auth/login"),Promise.reject(e)});let o=s},2378:(e,t,r)=>{"use strict";function s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)e[s]=r[s]}return e}r.d(t,{A:()=>a});var a=function e(t,r){function a(e,a,o){if("undefined"!=typeof document){"number"==typeof(o=s({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var n in o)o[n]&&(l+="; "+n,!0!==o[n]&&(l+="="+o[n].split(";")[0]));return document.cookie=e+"="+t.write(a,e)+l}}return Object.create({set:a,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],s={},a=0;a<r.length;a++){var o=r[a].split("="),l=o.slice(1).join("=");try{var n=decodeURIComponent(o[0]);if(s[n]=t.read(l,n),e===n)break}catch(e){}}return e?s[e]:s}},remove:function(e,t){a(e,"",s({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,s({},this.attributes,t))},withConverter:function(t){return e(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},3863:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var s=r(5155),a=r(5239),o=r(2115);let l=e=>{let{images:t}=e,r=(e=>{let[t,r]=(0,o.useState)(0),s=(0,o.useCallback)(()=>{let r=Math.floor(Math.random()*e.length);return r===t?(r+1)%e.length:r},[e.length,t]);return(0,o.useEffect)(()=>{0===t&&r(s())},[s,t]),t})(t);return(0,s.jsx)("div",{className:"relative inset-0 w-full h-full",children:(0,s.jsx)("div",{className:"absolute inset-0 w-full h-full",children:(0,s.jsx)(a.default,{src:t[r],alt:"Background",fill:!0,sizes:"(max-width: 414px) 414px, (max-width: 768px) 100vw, (max-width: 1200px) 100vw, 100vw",className:"object-cover opacity-50 transition-opacity duration-500",priority:!0,quality:75})})})}},5950:(e,t,r)=>{"use strict";r.d(t,{H:()=>s});let s="http://localhost:4000"},7088:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(5155),a=r(2115);class o extends a.Component{static getDerivedStateFromError(e){return console.error("Error caught:",e),{hasError:!0}}componentDidCatch(e,t){console.error("Erreur captur\xe9e par ErrorBoundary:",e,t)}render(){return this.state.hasError?(0,s.jsxs)("div",{className:"text-center p-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Une erreur est survenue"}),(0,s.jsx)("button",{onClick:()=>this.setState({hasError:!1}),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"R\xe9essayer"})]}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}let l=o},8489:(e,t,r)=>{"use strict";r.d(t,{F:()=>o});var s=r(5125),a=r(2378);s.A.defaults.withCredentials=!0;let o=s.A.create({baseURL:"http://localhost:4000"});o.interceptors.request.use(e=>{let t=a.A.get("token")||localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{var t;return["/api/synthetisers"].includes(e.config.url)||null==(t=e.response)||t.status,Promise.reject(e)}),o.interceptors.response.use(e=>e,e=>(e.response?(console.error("Erreur de r\xe9ponse:",{status:e.response.status,data:e.response.data}),401===e.response.status&&localStorage.removeItem("token")):e.request?console.error("Erreur de requ\xeate:",e.request):console.error("Erreur:",e.message),Promise.reject(e)))},8791:(e,t,r)=>{Promise.resolve().then(r.bind(r,2110))}},e=>{e.O(0,[239,125,441,255,358],()=>e(e.s=8791)),_N_E=e.O()}]);